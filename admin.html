<!doctype html><html lang="ar" dir="rtl"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>لوحة إدارة التقييمات</title>
<link rel="stylesheet" href="css.css">
</head><body>
<header>
  <div class="container nav">
    <div class="brand"><img class="logo" src="images/logo.png"><strong>waai-kids.sa</strong></div>
    <nav class="menu">
      <a href="index.html">الرئيسية</a>
      <a href="admin.html" class="is-active">لوحة الإدارة</a>
    </nav>
  </div>
</header>

<main class="container" style="padding:18px 0">
  <h1>إدارة التقييمات</h1>
  <div class="card" data-reveal><div class="body">
    <input id="k" class="ghost" placeholder="ADMIN_KEY (افتراضيًا 123123)" style="max-width:280px">
    <button class="btn" onclick="localStorage.setItem('admin_key', document.getElementById('k').value.trim());alert('تم الحفظ')">حفظ</button>
    <button class="ghost" onclick="loadAll()">تحديث</button>
    <div style="overflow:auto;margin-top:10px">
      <table style="width:100%;border-collapse:collapse">
        <thead><tr><th>الاسم</th><th>النجوم</th><th>النص</th><th>الحالة</th><th>الإجراءات</th></tr></thead>
        <tbody id="rows"></tbody>
      </table>
    </div>
  </div></div>
</main>

<script>
const API='/api/reviews'; const key=()=>localStorage.getItem('admin_key')||'123123';
async function loadAll(){
  const r=await fetch(API,{headers:{'x-admin-key':key()}}); const list=await r.json(); const tb=document.getElementById('rows'); tb.innerHTML='';
  list.forEach(x=>{ const tr=document.createElement('tr');
    tr.innerHTML=`<td>${x.name||'ضيف'}</td><td>${x.stars}</td><td>${x.text}</td><td>${x.approved?'معتمد':'مخفي'}</td>
    <td><button class='ghost' onclick='toggle(${x.id}, ${!x.approved})'>${x.approved?'إخفاء':'اعتماد'}</button>
    <button class='ghost' style="background:#fee" onclick='delv(${x.id})'>حذف</button></td>`;
    tb.appendChild(tr);
  });
}
async function delv(id){ if(!confirm('حذف نهائي؟')) return; const r=await fetch(API+'?id='+id,{method:'DELETE',headers:{'x-admin-key':key()}}); if(!r.ok) return alert('فشل الحذف'); loadAll(); }
async function toggle(id,approved){ const r=await fetch(API,{method:'PATCH',headers:{'Content-Type':'application/json','x-admin-key':key()},body:JSON.stringify({id,approved})}); if(!r.ok) return alert('فشل التعديل'); loadAll(); }
document.getElementById('k').value=key(); loadAll();
</script>
</body></html>